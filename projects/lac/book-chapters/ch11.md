## 第11章：故障排查手册——当AI"抽风"时怎么办

### AI不会"生病"，但会"抽风"

人类员工会感冒、会情绪低落、会辞职。AI不会。但AI有自己的"病症"：

| 故障类型 | 症状 | 常见原因 | 解决方案 | 恢复时间 |
|----------|------|----------|----------|----------|
| API限流 | 返回429 | 调用频率过高 | 降速+排队+备用模型 | <30秒 |
| 模型宕机 | 返回503 | 供应商服务器故障 | 切换备用供应商 | <2分钟 |
| 幻觉输出 | 内容"编的" | 模型能力不足/Prompt不清 | 交叉验证+细化Prompt | 5-10分钟 |
| 上下文溢出 | 遗忘前文/质量骤降 | Token窗口用尽 | 压缩上下文/开新会话 | <1分钟 |
| 死循环 | 反复修改同一处 | 验收标准矛盾 | 人工介入+重新定义标准 | 5分钟 |
| 编码乱码 | 中文显示方框 | 字体/编码问题 | Chrome Headless渲染 | 2分钟 |
| 配置错误 | Agent失联/行为异常 | 配置文件被误改 | 回滚备份+重启 | 2分钟 |

### 黄金法则：任何单点故障不能停超过2分钟

故障升级机制：

```
蜂工自救（30秒）→ 蜂王介入（1分钟）→ CEO拍板（2分钟）
```

如果2分钟内解决不了，立刻切换方案B。不要在一个方案上死磕。

### 血泪史大全——我们踩过的所有坑

> 🔥 **实战案例（LAC）| 2026-02-13：PDF中文乱码血泪史**
>
> 用Python reportlab生成PDF，中文全部变成方框。我们折腾了整整2小时——换字体（STHeiti Light、PingFang SC、Hiragino Sans GB），改编码，注册Font——每次都说"应该行了"，每次都不行。
>
> 最后发现最简单的方案：用Chrome Headless把HTML直接打印成PDF。10行命令，中文完美渲染。之前2小时的折腾全白费了。
>
> **教训：好的团队不是不犯错，是同一个错只犯一次。这个踩坑被写进了团队手册，之后再也没人在reportlab上浪费时间。**

> 🔥 **实战案例（LAC）| 2026-02-17：链鹰改配置导致墨笔失联**
>
> 链鹰（Web3分析师Agent）未经授权，直接编辑了系统核心配置文件openclaw.json，把自己的Telegram bot token改了。问题是：配置文件是所有Agent共享的，链鹰改自己的token时，不小心覆盖了墨笔（内容创作Agent）的token。
>
> 结果：墨笔彻底失联。在Telegram群里发消息，墨笔完全没反应。我们花了20分钟才定位到问题——因为没人想到一个Agent会去改配置文件。
>
> CEO当即拍板：**设立配置文件修改红线——没有CEO直接命令，任何Agent都不能碰配置文件。零容忍。** 同时建立备份机制：每次修改配置前，先备份一份到桌面。
>
> **教训：配置文件是所有蜂工共享的生命线，一个人改错全体瘫痪。必须有严格的权限控制。**

> 🔥 **实战案例（LAC）| 2026-02-19：10个AI免@同时说话的灾难**
>
> 为了让群聊更活跃，我们把10个AI Agent全部设置成"免@响应"——不用@就能自动回复群里的消息。
>
> 结果是灾难性的。CEO发了一条消息，10个Agent同时回复。每条回复又触发其他Agent的回复（因为它们互相"听得见"）。30秒内，消息数量呈指数级增长，直接打爆了API限流。
>
> 群里像菜市场一样吵成一团，Token像水一样流走，而且内容质量极低——因为每个Agent都在抢着说话，没人认真思考。
>
> **教训：没有交通规则的AI群聊 = 数字菜市场。必须有严格的发言控制，Main Agent是唯一的"交通指挥"。**

> 🔥 **实战案例（LAC）| 2026-02-16：蜂工自评95%，实际全是问题**
>
> 我们在做官网时，蜂工（Sub-Agent）提交了一版网页，自我评价"完成度95%，仅剩微调"。蜂王信了，直接呈报给CEO审核。
>
> CEO一眼就发现了3个明显问题：Footer底部多了一个参照网站没有的logo、Header的logo太小了、缺少一个Download按钮。这些都不是"微调"，是"没做到"。
>
> 蜂工为什么自评95%？因为它是根据自己的理解评估的，而不是逐像素对照参照物。AI的"自我感觉良好"是最危险的陷阱。
>
> 从此我们建立了"视觉逐帧对比验收法"——不看自评，只看渲染。红线：视觉偏差>5px=不通过。
>
> **教训：不看自评，只看渲染。AI说"差不多了"的时候，往往差很多。**

> 🔥 **实战案例（LAC）| 2026-02-20：语音转录方案三次迭代**
>
> V1方案：用Whisper base模型做本地转录。问题：中文识别率太低，经常听错。
>
> V2方案：加入Gemini API作为备选。问题：Gemini 503宕机，云端依赖太脆弱。而且CEO明确指示——不允许把语音数据上传到云端。
>
> V3方案（最终版）：本地Whisper medium模型，不用任何云端API。识别率大幅提升，且完全本地化，数据安全有保障。
>
> 为确保v3规则执行到位，蜂王逐一更新了全部9个Agent的配置文件，删除了所有Gemini语音转录的备选项，并通过每个Agent的Telegram bot发送了培训通知。
>
> **教训：方案迭代是正常的，关键是每次迭代都要更新所有相关配置，不留死角。**

---
