(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[520],{63:(e,t,a)=>{"use strict";var s=a(7260);a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}})},4523:(e,t,a)=>{Promise.resolve().then(a.bind(a,5404))},5404:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>c});var s=a(5155),l=a(2115),r=a(63),n=a(2619),o=a.n(n),i=a(6707);function c(){let e=(0,r.useRouter)(),{login:t}=(0,i.A)(),[a,n]=(0,l.useState)({email:"",password:""}),[c,d]=(0,l.useState)(!1),[u,m]=(0,l.useState)(""),[R,S]=(0,l.useState)(!1),[E,W]=(0,l.useState)(""),[C,K]=(0,l.useState)(""),[P,B]=(0,l.useState)(""),[T,F]=(0,l.useState)("email"),[L,D]=(0,l.useState)(!1),[M,G]=(0,l.useState)(""),[H,J]=(0,l.useState)(""),x=async s=>{s.preventDefault(),d(!0),m("");try{var l,r,n,o;let s=await fetch("".concat("https://ygfprjmevukjzwaqlblf.supabase.co","/functions/v1/auth-email/signin"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a.email,password:a.password})}),i=await s.json();s.ok&&(null==(l=i.data)?void 0:l.accessToken)?(t(null==(r=i.data)?void 0:r.accessToken,(null==(o=i.data)||null==(n=o.user)?void 0:n.username)||"用户",i.data&&i.data.user&&i.data.user.id||null),e.push("/profile")):m(i.error||"登录失败，请检查邮箱和密码")}catch(e){m("网络错误，请稍后重试")}finally{d(!1)}},p=e=>{n({...a,[e.target.name]:e.target.value})},q=async a=>{a.preventDefault(),D(!0),J(""),G("");try{let a=await fetch("".concat("https://ygfprjmevukjzwaqlblf.supabase.co","/functions/v1/auth-email/reset-password"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:E})}),t=await a.json();a.ok&&t.success?(G(t.message||"验证码已发送"),F("code")):J(t.error||"发送失败")}catch(a){J("网络错误，请稍后重试")}finally{D(!1)}},V=async a=>{a.preventDefault(),D(!0),J(""),G("");try{let a=await fetch("".concat("https://ygfprjmevukjzwaqlblf.supabase.co","/functions/v1/auth-email/verify-reset-code"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:E,code:C,newPassword:P})}),t=await a.json();a.ok&&t.success?(G("密码重置成功！请使用新密码登录"),setTimeout(()=>{S(!1),F("email"),W(""),K(""),B(""),G("")},2e3)):J(t.error||"重置失败")}catch(a){J("网络错误，请稍后重试")}finally{D(!1)}};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("section",{className:"pt-32 pb-16 lg:pb-20 bg-gradient-to-b from-white to-surface",children:(0,s.jsxs)("div",{className:"max-w-[1200px] mx-auto px-6 text-center",children:[(0,s.jsx)("span",{className:"section-label justify-center",children:"Login"}),(0,s.jsx)("h1",{className:"text-4xl lg:text-[56px] font-black text-navy leading-[1.1] mb-6 tracking-tight",children:"登录 LAC"}),(0,s.jsx)("p",{className:"text-lg text-gray-500 max-w-[680px] mx-auto leading-relaxed",children:"欢迎回来！继续你的 AI 学习之旅"})]})}),(0,s.jsx)("section",{className:"py-16 lg:py-24",children:(0,s.jsx)("div",{className:"max-w-[500px] mx-auto px-6",children:(0,s.jsxs)("div",{className:"card p-12",children:[(0,s.jsx)("div",{className:"w-20 h-20 rounded-full bg-gold/10 flex items-center justify-center text-4xl mx-auto mb-8",children:"\uD83D\uDD10"}),(0,s.jsxs)("form",{onSubmit:x,className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"email",className:"block text-sm font-semibold text-navy mb-3",children:"邮箱地址"}),(0,s.jsx)("input",{type:"email",id:"email",name:"email",value:a.email,onChange:p,required:!0,className:"w-full px-4 py-3 rounded-xl border border-[#E8EAF0] focus:border-gold focus:ring focus:ring-gold/20 outline-none transition-all duration-200",placeholder:"请输入您的邮箱地址"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"password",className:"block text-sm font-semibold text-navy mb-3",children:"密码"}),(0,s.jsx)("input",{type:"password",id:"password",name:"password",value:a.password,onChange:p,required:!0,className:"w-full px-4 py-3 rounded-xl border border-[#E8EAF0] focus:border-gold focus:ring focus:ring-gold/20 outline-none transition-all duration-200",placeholder:"请输入您的密码"})]}),u&&(0,s.jsx)("div",{className:"text-red-500 text-sm bg-red-50 px-4 py-3 rounded-xl",children:u}),(0,s.jsx)("button",{type:"submit",disabled:c,className:"w-full btn btn-primary btn-lg",children:c?"登录中...":"登录"})]}),(0,s.jsx)("div",{className:"mt-6 text-center",children:(0,s.jsx)("button",{type:"button",onClick:()=>S(!0),className:"text-gold hover:text-gold-light text-sm font-medium",children:"忘记密码？"})}),(0,s.jsx)("div",{className:"mt-4 text-center",children:(0,s.jsxs)("p",{className:"text-gray-500 text-sm",children:["还没有账户？"," ",(0,s.jsx)(o(),{href:"/register",className:"text-gold hover:text-gold-light font-semibold",children:"立即注册"})]})})]})})})},R&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-6",children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl p-8 max-w-[420px] w-full",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h3",{className:"text-xl font-bold text-navy",children:"email"===T?"重置密码":"输入验证码"}),(0,s.jsx)("button",{onClick:()=>{S(!1),F("email"),J(""),G("")},className:"text-gray-400 hover:text-gray-600 text-2xl",children:"×"})]}),M&&(0,s.jsx)("div",{className:"text-green-600 text-sm bg-green-50 px-4 py-3 rounded-xl mb-4",children:M}),H&&(0,s.jsx)("div",{className:"text-red-500 text-sm bg-red-50 px-4 py-3 rounded-xl mb-4",children:H}),"email"===T?(0,s.jsxs)("form",{onSubmit:q,className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-semibold text-navy mb-2",children:"邮箱地址"}),(0,s.jsx)("input",{type:"email",value:E,onChange:a=>W(a.target.value),required:!0,className:"w-full px-4 py-3 rounded-xl border border-[#E8EAF0] focus:border-gold focus:ring focus:ring-gold/20 outline-none",placeholder:"请输入注册邮箱"})]}),(0,s.jsx)("button",{type:"submit",disabled:L,className:"w-full btn btn-primary btn-lg",children:L?"发送中...":"发送验证码"})]}):(0,s.jsxs)("form",{onSubmit:V,className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-semibold text-navy mb-2",children:"验证码"}),(0,s.jsx)("input",{type:"text",value:C,onChange:a=>K(a.target.value),required:!0,maxLength:6,className:"w-full px-4 py-3 rounded-xl border border-[#E8EAF0] focus:border-gold focus:ring focus:ring-gold/20 outline-none text-center text-2xl tracking-widest",placeholder:"000000"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-semibold text-navy mb-2",children:"新密码"}),(0,s.jsx)("input",{type:"password",value:P,onChange:a=>B(a.target.value),required:!0,minLength:8,className:"w-full px-4 py-3 rounded-xl border border-[#E8EAF0] focus:border-gold focus:ring focus:ring-gold/20 outline-none",placeholder:"请输入新密码（至少8位）"})]}),(0,s.jsx)("button",{type:"submit",disabled:L,className:"w-full btn btn-primary btn-lg",children:L?"重置中...":"重置密码"}),(0,s.jsx)("button",{type:"button",onClick:()=>F("email"),className:"w-full text-sm text-gray-500 hover:text-gray-700",children:"返回重新发送"})]})]})})]})}},6707:(e,t,a)=>{"use strict";a.d(t,{A:()=>n,AuthProvider:()=>o});var s=a(5155),l=a(2115);let r=(0,l.createContext)(void 0),n=()=>{let e=(0,l.useContext)(r);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},o=e=>{let{children:t}=e,[a,n]=(0,l.useState)(!1),[o,i]=(0,l.useState)(""),[c,d]=(0,l.useState)(null),[p,f]=(0,l.useState)(null),[u,m]=(0,l.useState)(!0);return(0,l.useEffect)(()=>{(async()=>{let e=localStorage.getItem("lac_token");if(!e)return m(!1);let g=localStorage.getItem("lac_username"),h=localStorage.getItem("lac_user_id");g&&(n(!0),i(g),f(h),d(e));try{let t=await fetch("".concat("https://ygfprjmevukjzwaqlblf.supabase.co","/functions/v1/user-profile"),{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(t.ok){let a=await t.json(),v=a.data&&a.data.username||a.username||"用户",w=a.data&&a.data.id||a.id||null;n(!0),i(v),f(w),d(e),localStorage.setItem("lac_username",v),w&&localStorage.setItem("lac_user_id",w)}else localStorage.removeItem("lac_token"),localStorage.removeItem("lac_username"),localStorage.removeItem("lac_user_id"),n(!1)}catch(e){g||n(!1)}finally{m(!1)}})()},[]),(0,s.jsx)(r.Provider,{value:{isLoggedIn:a,username:o,userId:p,token:c,login:(e,t,u)=>{localStorage.setItem("lac_token",e),localStorage.setItem("lac_username",t),u&&localStorage.setItem("lac_user_id",u),d(e),i(t),u&&f(u),n(!0)},logout:()=>{localStorage.removeItem("lac_token"),localStorage.removeItem("lac_username"),localStorage.removeItem("lac_user_id"),d(null),i(""),f(null),n(!1)},loading:u},children:t})}}},e=>{e.O(0,[619,441,493,358],()=>e(e.s=4523)),_N_E=e.O()}]);